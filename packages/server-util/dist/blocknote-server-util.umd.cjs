(function(o,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("@blocknote/core"),require("@blocknote/react"),require("jsdom"),require("react"),require("react-dom"),require("y-prosemirror")):typeof define=="function"&&define.amd?define(["exports","@blocknote/core","@blocknote/react","jsdom","react","react-dom","y-prosemirror"],r):(o=typeof globalThis<"u"?globalThis:o||self,r(o["blocknote-server-util"]={},o.core,o.react$1,o.jsdom,o.react,o.require$$0,o.yProsemirror))})(this,function(o,r,i,T,u,h,d){"use strict";var S=Object.defineProperty;var b=(o,r,i)=>r in o?S(o,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[r]=i;var m=(o,r,i)=>b(o,typeof r!="symbol"?r+"":r,i);const y=s=>s&&typeof s=="object"&&"default"in s?s:{default:s};function k(s){if(s&&typeof s=="object"&&"default"in s)return s;const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const t in s)if(t!=="default"){const n=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>s[t]})}}return e.default=s,Object.freeze(e)}const f=k(T),w=y(h);var a,c=w.default;if(process.env.NODE_ENV==="production")a=c.createRoot,c.hydrateRoot;else{var p=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;a=function(s,e){p.usingClientEntryPoint=!0;try{return c.createRoot(s,e)}finally{p.usingClientEntryPoint=!1}}}class l{constructor(e){m(this,"editor");m(this,"jsdom",new f.JSDOM);this.editor=r.BlockNoteEditor.create({...e,_headless:!0})}async _withJSDOM(e){const t=globalThis.window,n=globalThis.document;globalThis.document=this.jsdom.window.document,globalThis.window=this.jsdom.window,globalThis.window.__TEST_OPTIONS=t==null?void 0:t.__TEST_OPTIONS;try{return await e()}finally{globalThis.document=n,globalThis.window=t}}static create(e={}){return new l(e)}_prosemirrorNodeToBlocks(e){const t=[];return e.firstChild.descendants(n=>(t.push(r.nodeToBlock(n,this.editor.schema.blockSchema,this.editor.schema.inlineContentSchema,this.editor.schema.styleSchema)),!1)),t}_prosemirrorJSONToBlocks(e){const t=this.editor.pmSchema.nodeFromJSON(e);return this._prosemirrorNodeToBlocks(t)}_blocksToProsemirrorNode(e){const t=e.map(_=>r.blockToNode(_,this.editor.pmSchema,this.editor.schema.styleSchema));return this.editor.pmSchema.topNodeType.create(null,this.editor.pmSchema.nodes.blockGroup.create(null,t))}yXmlFragmentToBlocks(e){const t=d.yXmlFragmentToProseMirrorRootNode(e,this.editor.pmSchema);return this._prosemirrorNodeToBlocks(t)}blocksToYXmlFragment(e,t){return d.prosemirrorToYXmlFragment(this._blocksToProsemirrorNode(e),t)}yDocToBlocks(e,t="prosemirror"){return this.yXmlFragmentToBlocks(e.getXmlFragment(t))}blocksToYDoc(e,t="prosemirror"){return d.prosemirrorToYDoc(this._blocksToProsemirrorNode(e),t)}async blocksToHTMLLossy(e){return this._withJSDOM(async()=>r.createExternalHTMLExporter(this.editor.pmSchema,this.editor).exportBlocks(e,{document:this.jsdom.window.document}))}async blocksToFullHTML(e){return this._withJSDOM(async()=>r.createInternalHTMLSerializer(this.editor.pmSchema,this.editor).serializeBlocks(e,{document:this.jsdom.window.document}))}async tryParseHTMLToBlocks(e){return this._withJSDOM(()=>this.editor.tryParseHTMLToBlocks(e))}async blocksToMarkdownLossy(e){return this._withJSDOM(async()=>r.blocksToMarkdown(e,this.editor.pmSchema,this.editor,{document:this.jsdom.window.document}))}async tryParseMarkdownToBlocks(e){return this._withJSDOM(()=>this.editor.tryParseMarkdownToBlocks(e))}async withReactContext(e,t){return this._withJSDOM(async()=>{const n=a(this.jsdom.window.document.createElement("div"));h.flushSync(()=>{n.render(u.createElement(e,{},u.createElement(i.BlockNoteViewRaw,{editor:this.editor})))});try{return await t()}finally{n.unmount()}})}}o.ServerBlockNoteEditor=l,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=blocknote-server-util.umd.cjs.map
